{% extends "base.html" %}
{% block title %}Sentence Review â€” Links{% endblock %}

{# ðŸ‘‡ This overrides the container in base.html to make this page full-width #}
{% block container_class %}container-fluid px-5 py-4{% endblock %}

{% block content %}
<h1 class="mb-3">Sentence Review â€” Links</h1>

<div class="p-3 mb-3 rounded shadow-sm bg-info-subtle border border-info-subtle">
  <h5 class="mb-1 fw-semibold">ðŸ“Š {{ total_sentences }} sentences across {{ total_links }} links</h5>
  <div class="d-flex flex-wrap gap-3 mt-2">
    <span class="badge bg-secondary text-light px-3 py-2">New: {{ status_counts.get('new', 0) }}</span>
    <span class="badge bg-success text-light px-3 py-2">Reviewed: {{ status_counts.get('reviewed', 0) }}</span>
    <span class="badge bg-warning text-dark px-3 py-2">Rejected: {{ status_counts.get('rejected', 0) }}</span>
    <span class="badge bg-dark text-light px-3 py-2">Duplicates: {{ status_counts.get('duplicate', 0) }}</span>
  </div>
</div>

{% if domain_counts %}
<div class="mt-4">
  <h6 class="fw-semibold text-uppercase text-muted mb-2">
    <i class="bi bi-diagram-3 me-1"></i> Domain Distribution (Reviewed Sentences Only)
  </h6>

  <div class="p-3 rounded shadow-sm bg-white border border-light-subtle">
    <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-6 g-2">
      {% for domain in domain_counts.items() %}
      {% set name, data = domain %}
      <div class="col">
        <a href="{{ url_for('view_domain', domain_id=data[1]) }}" 
          class="text-decoration-none text-dark">
          <div class="d-flex justify-content-between align-items-center border rounded p-2 small bg-light-subtle hover-shadow">
            <span class="text-truncate fw-medium" title="{{ name }}">{{ name }}</span>
            <span class="badge bg-primary-subtle text-dark ms-2">{{ data[0] }}</span>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endif %}

{% if not has_backlog %}
  <div class="alert alert-success mt-4 text-center fs-5 py-4 shadow-sm border border-success-subtle bg-success-subtle">
    ðŸŽ‰ Hoorah! No backlog to review â€” all caught up! ðŸŽ‰
  </div>
{% else %}

<nav class="mt-4">
  <ul class="pagination justify-content-center">
    {% if page > 1 %}
      <li class="page-item"><a class="page-link" href="{{ url_for('index') }}?page={{ page-1 }}">Previous</a></li>
    {% endif %}
    <li class="page-item disabled"><span class="page-link">Page {{ page }} / {{ total_pages }}</span></li>
    {% if page < total_pages %}
      <li class="page-item"><a class="page-link" href="{{ url_for('index') }}?page={{ page+1 }}">Next</a></li>
    {% endif %}
  </ul>
</nav>
<p class="text-muted mt-4">Showing links {{ start }}â€“{{ end }} of {{ total_links }}, page {{ page }} / {{ total_pages }}</p>
<div class="mt-4">
  <div class="table-responsive mt-3">
    <table class="table table-striped table-hover align-middle w-100">
      <thead class="table-light sticky-top">
        <tr>
          <th style="width:40%;">Link</th>
          <th>Total</th>
          <th>New</th>
          <th>Reviewed</th>
          <th>Rejected</th>
          <th>Duplicate</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for link in links %}
        <tr>
          <td class="text-wrap" style="max-width: 40%; word-break: break-word; white-space: normal;">
            <a href="{{ link.url }}" target="_blank" class="text-decoration-none text-break" title="{{ link.url }}">
              {{ link.url }}
            </a>
          </td>
          <td>{{ link.total }}</td>
          <td><span class="badge bg-secondary">{{ link.new }}</span></td>
          <td><span class="badge bg-success">{{ link.reviewed }}</span></td>
          <td><span class="badge bg-warning text-dark">{{ link.rejected }}</span></td>
          <td><span class="badge bg-dark text-light">{{ link.duplicate }}</span></td>
          <td><a class="btn btn-sm btn-primary" href="{{ url_for('view_link', link_id=link.id) }}">Review</a></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<nav class="mt-4">
  <ul class="pagination justify-content-center">
    {% if page > 1 %}
      <li class="page-item"><a class="page-link" href="{{ url_for('index') }}?page={{ page-1 }}">Previous</a></li>
    {% endif %}
    <li class="page-item disabled"><span class="page-link">Page {{ page }} / {{ total_pages }}</span></li>
    {% if page < total_pages %}
      <li class="page-item"><a class="page-link" href="{{ url_for('index') }}?page={{ page+1 }}">Next</a></li>
    {% endif %}
  </ul>
</nav>
{% endif %}
{% endblock %}
